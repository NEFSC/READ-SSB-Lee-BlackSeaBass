---
title: "Black Sea Bass Data Summary"
author: "Min-Yang Lee"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
header-includes: \usepackage{setspace}\doublespacing
urlcolor: blue
editor_options:
  chunk_output_type: console
fontsize: 12pt
---

# Summary and Housekeeping

This is a data summary document. I ran the files ``\stata_code\data_extraction_processing\extraction\commercial\00_cams_extraction.do`` and ``00_extraction_wrapper.do``

I also ran all the files in ``\stata_code\data_extraction_processing\analysis`` to do some exploratory analysis. 

Warnings: There is something funky going on with VA "status=PZERO" starting in 2021.  There is also something funky going on with Delaware landings, but there are no hullids/permit numbers so I don't think this will throw anything off at the vessel level.


\clearpage


# Regulations and Background

## A brief history

The fishery is managed by the ASFMC and the MAFMC.  There is also a South Atlantic stock that is managed by SAFMC, but we will ignore it.

  * Initial FMP in 1996 set quarterly quotas
  * 2001/2002 Amendment 13 did annual quotas and state-by-state allocations to start in 2003/4 and that were managed by ASFMC.
  * 2004 -- Addendum 12 (ASFMC) allowed for transfer of commercial quota across states.  So did Add 19 in 2007.
  * Addendum 20 allowed for all kinds of quota to be transferred across states.

    * If the coastwide quota is *not* exceeded, state-specific overages are forgiven.
    * If the coastwide quota is exceeded, states with underages can contribute them to a pool that is then reallocated.

  * 2021 -- Add 31 put in a new formula for commercial quota.  75% of the quota is allocated according to historical fishing. 25% is allocated inproportion to where the biomass is located (based on stock assessment).
  
There is quite a bit of fishing that occurs within state waters, so the VTR coverage isn't perfect.  It is particularly rough in NY, CT, RI, and MA (especially MA).


## Relevant current regulations

Three states have IFQ programs (MD, DE, and VA) that started in 2004. I don't know if NC and NJ are valid "untreated" states.  Certainly not for prices.

Maryland [https://www.law.cornell.edu/regulations/maryland/COMAR-08-02-05-21]

  * Need a commercial license
  * Has up to 14 landing permits, which are issued to people. That person does not need to be aboard the vessel (Operators).
  * State quota is allocated to the holders of these permits.
  * 50 lb incidental (open access) limits 
  * Must be sold to a federally permitted dealer.
  * There are restrictions on the type of trawl (4 1/2" cod end, 18" or less roller rig)
  * there are restrictions on pot/trap (2 1/2" circular opening, 2" square or 1 3/8 x 5 3/4" rectangular, plus 1 degradable panel or door 3 x 6)
  
Virginia [https://mrc.virginia.gov/Regulations/fr950.shtm]

  * Need a directed bsb permit and either a commercial fisherman license or a seafood landing license.
  * Pots restrictions (same as MD)
  * 40,000 lbs allocated to the "bycatch" fishery and everythign else is allocated to the quota fishery
  * Quota allocated based on a person's history from July 1, 1997 to December 31, 2001.
  * Bycatch fishery
    * 200lbs plus the NC legal limit, reduced to 100lbs plus the limit when the bycatch fishery hits 75% or
    * 1,500 lbs as long as that is less than 10% of the weight of SF, scup, longfin squid, and mackerel.
  

Delaware [https://regulations.delaware.gov/AdminCode/title7/3000/3500/3501.shtml]

  * A landing permit is required
  * Up to 6 landing permits for pots (96% of the quota), plus up to 13 hook and line permits (4% of the quota).
  * Firms with a pot permit must have a Federal BSB permit. 
  * One transfer per year
  * I don't see any restrictions on gear or possession, but I see black spaces so these could have been removed.
  * I also don't see anything on the regulations page about initial quota allocations
  * No provision for incidental or bycatch 
  * Pots restrictions (same as MD)


North Carolina

  * These change a bit, but in 2024, the regulations are 
    * Trawls -- 5,000 lb possession limit
    * Pot, Trap, Line -- 3,000 lb of black sea bass.
  * Properly licensed vessel Captains employing trawls can possess landing limits for other states, but it is unlawful to offload those fish in North Carolina

New Jersey

  * There is a complicated set of options, but basically each bi-monthly season has a weekly landing limit. 
  * It looks like there is a limited access program
  * There is also a bycatch limit of 10% not to exceed 100 lbs. 
  * 4 1/2" diamond or 4" squarecod end.
  * Any commercial vessel landing black sea bass for sale must sell to a permitted New Jersey Black Sea Bass Dealer.


The "landing restrictions" seem to be doing two things. They are certainly limiting access, but they are also preventing out of state vessels from landing in your home state. I think this might have to do with how the landings are counted against the quota.

There are two populations managed by the ASFMC. The South stock is from Beaufort/Cape Hatteras, NC north to Hudson Canyon (Statistical Areas 621 and higher, plus statistical areas 614 and 615). The North stock is everything north of that (all the 5XX statistical areas, plus 611,612, 613, 616). 

20-30% of removals come from the commercial fishery, which fishes on slightly smaller individuals than the recreational fishery. 

There were strong year classes in 2011 and 2015.

There in an Inshore movement (beginning of summer) and an offshore movement (late fall). This is an West-East movement, but also a North-South movement.

# Goings on

## Summer Flounder

There is a Summer Flounder Management Strategy Evaluation. In addition, S&T has a contractor working on 1 year project to estimate a Summer Flounder production function that contains environmental covariates.  SF and BSB are often caught together, so they are planning to estimate a multi-output production function.

There have been allocation analysis for Scup [@GentnerConsultingGroup2012] and Summer Flounder [@Gentner2010;@Hicks2017; @Hicks2020]. The basic question is all is the optimal allocation between the commercial and recreational sectors. All have some sort of demand model, some model of production, and some valuation coming out of the recreational side.

## Black Sea Bass

> Another source of uncertainty stemmed from the fact that no length information on
individuals in the unclassified market category have been sampled since 2020. Calculating the catch at length
for 2021-2023 necessitated borrowing information from before 2020 which introduces additional uncertainty. [BSB management track assessment report]


Miller, A. S., Shepherd, G. R., & Fratantoni, P. S. (2016). Offshore habitatpreference of overwintering juvenile and adult Black Sea Bass, Centropristis striata, and the relationship to year-class success. PLoS One, 11(1), e0147627. https:// doi. org/ 10. 1371/ journ al. pone. 0147627

Morley, J. W., Frölicher, T. L., & Pinsky, M. L. (2020). Characterizing uncertainty in climate impact projections: A case study with seven marine species on the North American Continental Shelf. ICES Journal of Marine Science, 77(6), 2118–2133. https:// doi. org/ 10. 1093/icesj ms/fsaa103

Morley, J. W., Selden, R. L., Latour, R. J., Frölicher, T. L., Seagraves, R. J., & Pinsky, M. L. (2018). Projecting shifts in thermal habitat for 686 species on the North American Continental Shelf. PLoS One, 13(5), e0196127. https:// doi. org/ 10. 1371/ journ al. pone. 0196127

Bandara, R. M. W. J., Curchitser, E., & Pinsky, M. L. (2024). The importance of oxygen for explaining rapid shifts in a marine fish. Global Change Biology, 30, e17008. https://doi.org/10.1111/gcb.17008

https://github.com/wajra/bsb-shift-drivers

https://doi.org/10.5281/zenodo.10023533

# Research Questions

1.  Can we use information in prices to assign a market category to the unclassified fish?  
  * Run a categorical model (ordered or un-ordered logit?) with price as a right hand side variable.  Then predict out of sample for the unclassified market category.
  
  * Estimate a latent class (finite mixture model) on the price of unclassified, where there are a moderate number of classes (say small and large).  A test of the model would be to see how well it does on the classes.
  
  * There's approximately 5% of fish that are Unclassified, so the magnitude of the effect on the stock assessment enterprise is probably minimal. But it might illustrate areas where we can shift sampling. 
  
2. Three states have implemented a catch share for Black Sea Bass. What has happened in these fisheries?

3. Many of the states have enacted limited access for landing permits. They tend to be the southern states.  What are the welfare effects? Is this a good idea? What is the political economy?  What is the economic game at the ASFMC and what are the objectives of the individuals?
    
    * Talk to Emily (Although Emily is moving off BSB) at GARFO.  MAFMC and ASMFC staff too?
    * What kind of information exists at the state level? Can we get any more info, especially from MA, RI, and CT about fishing effort?
    * How has the BSB fishery played out for the catch share states compared to the non-catch share states? Greg has been using the cost data together to put together profitability profiles. 
        * For firms without a federal permit, I don't know how to feel about that.
    
 <!---- 
 The global_options chunk loads libraries, sets options, figures out if you're on a desktop or server, sets years, and sets graphing options
 --->
```{r global_options, include=FALSE}

 library("foreign")
 library("here")
 library("tidyverse")
 library("scales")
 library("knitr")
 library("lubridate")
 library("kableExtra")
  library("haven")

here::i_am("writing/BSB_data_summary.Rmd")

#############################################################################
#knitr options

knitr::opts_chunk$set(echo=FALSE, warning = FALSE, error = FALSE, message = FALSE, comment = FALSE, cache = FALSE, progress = TRUE, verbose = FALSE, 
											dpi = 600)
options(tinytex.verbose = TRUE)
# options(knitr.table.format = "latex")
#############################################################################
my_images<-here("images")

descriptive_images<-here("images","descriptive")
exploratory_images<-here("images","exploratory")

```





# Data

CAMS is the primary data source. CAMS is a joining of Dealer to other data sources, including VTR. 

I've always thought of the dealer data as a record of "transactions" -- each row represents a sale from a vessel to a dealer of a market category of fish (PERMIT-DEALER-DATE-NESPP4). There might be instances where there are multiple of these records per day (say a vessel lands 2x in a day), but these should not be too common. "trip level" information can be brought in through the VTR serial number, but sometimes this is not enough. From a stock assessment perspective, if a vessel fishes in two statistical areas, that information may be needed and the landings might need to be allocated to a statistical area.  Even if sales were at the (PERMIT-DEALER-DATE-statistical area-NESPP4) level, which they are not, we wouldn't be able to get this information because only 1 VTR per trip is observed per "trip."

A row in CAMS_LAND is an "allocated" landing; it is not necessarily a sales transaction (PERMIT-DEALER-DATE-NESPP4).



CAMS matches dealer records to VTR records. For trip-level things, I'm willing to accept 2 CAMS status as good -- "MATCH" and "DLR_ORPHAN_SPECIES." 

MATCH = records fully match at the CAMSID-ITIS_GROUP1 level; 

DLR_ORPHAN_SPECIES = in dealer. Trip is in vtr, but the *species* is not in VTR

DLR_ORPHAN_TRIP = in dealer. Neither Trip nor species is in vtr 

VTR_ORPHAN_SPECIES = trip is in dealer, but species in not in dealer. trip and species are in VTR

VTR_ORPHAN_TRIP = neither trip nor species are in dealer. trip and species are in VTR.

VTR_NOT_SOLD = VTR records kept for bait-home-consumption and therefore not sold to the dealer and not in dealer

PZERO = Records where PERMIT = '000000'. These are not included in the apportionment or imputation processes. The CAMS matching algorithm requires a permit number.  Some of these possibly could be matched through the algorithm, because there sometimes is a hullnum.  But i spot checked some and it didnt' work well

CFDERS_ALL_YEARS has a CF_License (Commercial fisherman license issued by a State)  and a state_dnum (State Dealer License Number) field. These are interesting. Do I "need" anything? or can I make do with these as dummies?


```{r data_summary, eval=TRUE}
vintage_string<-list.files(here("data_folder","raw","commercial"), pattern=glob2rx("landings_all*.dta"))
vintage_string<-gsub("landings_all_","",vintage_string)
vintage_string<-gsub(".dta","",vintage_string)
vintage_string<-max(vintage_string)
all_landings<-haven::read_dta(here("data_folder","raw","commercial", paste0("landings_all_",vintage_string,".dta")))
# nrows(all_landings)
# summary(all_landings)

working_landings<-all_landings %>%
  dplyr::filter(merge_species_codes==3) %>%
  dplyr::filter(!(permit %in% c(190998,290998,390998,490998))) %>%
  dplyr::filter(!(hullid=="0000000" & permit==0)) %>%
  dplyr::filter(!(hullid=="000000" & permit==0)) %>%
  dplyr::filter(!hullid=="FROM_SHORE") %>%
  dplyr::filter(state %in% c("CT","DE", "MA","MD", "NC","NJ", "NY","RI","VA")) %>%
  mutate(dlr_date=lubridate::date(dlr_date))


row_count<-nrow(working_landings)

total<-working_landings%>%
  summarise(year=9999,
            all=n(),
            all_lbs=sum(lndlb/1000),
            all_trips=n_distinct(camsid))

obs_by_year<-working_landings%>%
  group_by(year)  %>%
  summarise(all=n(),
            all_lbs=sum(lndlb/1000),
            all_trips=n_distinct(camsid)) %>%
  bind_rows(total)


kbl(obs_by_year, digits=0,booktabs=T, align=c("l",rep("r", times=2)), caption =  "CAMS observations, thousands of pounds, and unique trips (camsids)year") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE)

```


```{r data_summary_trips, eval=TRUE}
# how many unique trips and how many with a good matching status?
# I'm assuming that 


total<-working_landings%>%
  dplyr::filter(status %in% c("MATCH","DLR_ORPHAN_SPECIES")) %>%
  summarise(year=9999,
            match=n(),
            match_lbs=sum(lndlb/1000),
            match_trips=n_distinct(camsid)) 

obs_match<-working_landings%>%
  dplyr::filter(status %in% c("MATCH","DLR_ORPHAN_SPECIES")) %>%
  group_by(year) %>%
  summarise(match=n(),
            match_lbs=sum(lndlb/1000),
            match_trips=n_distinct(camsid)) %>%
  bind_rows(total)

kbl(obs_match, digits=0,booktabs=T, align=c("l",rep("r", times=2)), caption =  "CAMS observations, thousands of pounds, and unique trips (camsids)year") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 

```

This is a quick and dirty summary of trips. I group by CAMSID, permit, hullid, and year. The grouping by CAMSID, permit, and hullid is inocuous. 

the na.rm=TRUE option for the value sum is not inocuous.  There are some rows with value=null. We either need to fill in a price or remove the entire row.  Relatedly, there are some rows with value=0.  We might want to do the same.  Both of these might legitimately arise from home consumption or from "unsold".  There's also some suspiciousness regarding state level aggregates, but those are probably trimmed out already. 

I pull through the first gear and area for each camsid. I sum up the landed pounds and value. 

```{r trip_level_info, eval=TRUE}

trip<-working_landings %>%
  dplyr::filter(status %in% c("MATCH","DLR_ORPHAN_SPECIES")) %>%
  group_by(camsid, year, permit, hullid) %>%
  summarise(lndlb=sum(lndlb, na.rm=TRUE),
            value=sum(value, na.rm=TRUE),
            negear=first(negear),
            area=first(area))

# Trip level summary statistics , by year
summ1<-trip %>%
  group_by(year) %>%
  summarise(count=n(),
    avg_lndlb=mean(lndlb),
          p25_lndlb = quantile(lndlb, probs = .25),
            p50_lndlb = quantile(lndlb, probs = .50),
            p60_lndlb = quantile(lndlb, probs = .60),
            p75_lndlb = quantile(lndlb, probs = .75),
            p90_lndlb = quantile(lndlb, probs = .90),
            p95_lndlb = quantile(lndlb, probs = .95),
            p99_lndlb = quantile(lndlb, probs = .99)
        )
      

kbl(summ1, digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average landings, and percentiles of the distribution") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 

```


## by state
Adding state  will results in too many observations because a vessel could bring fish caught on a single trip to multiple states 

```{r state_trip, eval=TRUE}

trip2<-working_landings %>%
  dplyr::filter(status %in% c("MATCH","DLR_ORPHAN_SPECIES")) %>%
  group_by(camsid, year, permit, hullid, state) %>%
  summarise(lndlb=sum(lndlb, na.rm=TRUE),
            value=sum(value, na.rm=TRUE),
            negear=first(negear),
            area=first(area))



# Trip level summary statistics , by year
summ2<-trip2 %>%
  group_by(state, year) %>%
  summarise(count=n(),
    avg_lndlb=mean(lndlb),
          p25_lndlb = quantile(lndlb, probs = .25),
            p50_lndlb = quantile(lndlb, probs = .50),
            p60_lndlb = quantile(lndlb, probs = .60),
            p75_lndlb = quantile(lndlb, probs = .75),
            p90_lndlb = quantile(lndlb, probs = .90),
            p95_lndlb = quantile(lndlb, probs = .95),
            p99_lndlb = quantile(lndlb, probs = .99)
        )
      
kbl(summ2 %>%
      dplyr::filter(state %in% c("MA","RI","CT"))
    
    
    , digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average landings, and percentiles of the distribution, grouped by state") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 


```


```{r state_trip2, eval=TRUE}


      
kbl(summ2 %>%
      dplyr::filter(state %in% c("NY","NJ", "DE"))
    
    
    , digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average landings, and percentiles of the distribution, grouped by state") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 


```





```{r state_trip3, eval=TRUE}

kbl(summ2 %>%
      dplyr::filter(state %in% c("MD", "VA", "NC"))
    
    
    , digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average landings, and percentiles of the distribution, grouped by state") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 


```





```{r trip_length, eval=TRUE}


trip_length<-working_landings %>%
  dplyr::filter(status %in% c("MATCH","DLR_ORPHAN_SPECIES"))%>%
  dplyr::filter(!is.na(record_sail)) %>%
  dplyr::filter(!is.na(record_land)) %>%
  mutate(trip_hours=int_length(interval(record_sail, record_land))/(3600) )

  
  tl_table<-trip_length %>%
  group_by(year)%>%
  summarise(count=n(),
          avg_trip_hours=mean(trip_hours),
          p10_trip_hours = quantile(trip_hours, probs = .10),
          p25_trip_hours = quantile(trip_hours, probs = .25),
          p50_trip_hours = quantile(trip_hours, probs = .50),
            p75_trip_hours = quantile(trip_hours, probs = .75),
            p90_trip_hours = quantile(trip_hours, probs = .90),
            p95_trip_hours = quantile(trip_hours, probs = .95),
            p99_trip_hours = quantile(trip_hours, probs = .99)
  )
    
  
kbl(tl_table , digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average length (hours), and percentiles of the distribution") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 


```


```{r state_trip_length, eval=TRUE}
 tl_table2<-trip_length %>%
  group_by(state, year)%>%
  summarise(count=n(),
          avg_trip_hours=mean(trip_hours),
          p10_trip_hours = quantile(trip_hours, probs = .10),
          p25_trip_hours = quantile(trip_hours, probs = .25),
          p50_trip_hours = quantile(trip_hours, probs = .50),
            p75_trip_hours = quantile(trip_hours, probs = .75),
            p90_trip_hours = quantile(trip_hours, probs = .90),
            p95_trip_hours = quantile(trip_hours, probs = .95),
            p99_trip_hours = quantile(trip_hours, probs = .99)
  )
kbl(tl_table2 , digits=0,booktabs=T, align=c("l",rep("r",ncol(summ1)-1)), caption =  "Trips, average length (hours), and percentiles of the distribution, grouped by state") %>%
    kable_styling(full_width = T,latex_options = "hold_position") %>% 
      row_spec(0,bold=FALSE) 

```






```{r sql_spot_checks, eval=FALSE}

select hullnum, vtrserno, year, year_link, port, dealnum, vessel_name, permit, nespp3, nespp4, spplndlb, sppvalue, cf_license, dersource, partner_code, partner_affiliation, state_dnum, dealer_rpt_id, landing_seq, cfders_id 
from nefsc_garfo.cfders_all_years where permit='000000' and vtrserno is not null and year>=2015;


select * from nefsc_garfo.trip_reports_document where docid in (

select docid from nefsc_garfo.trip_reports_images where serial_num in ('215022331', '215000352','445789'));
```


## State level matching

The proportion of good matches landings in Delaware, Maryland, New Jersey, and Virginia are very high.  Matches for North Carolina are moderate, I wouldn't be surprised if this is a boundary issue with the south Atlantic.  New York, Rhode Island, and Connecticut are moderate and getting worse. Massachusetts is really bad.  There is a data error with VA that is making the last couple years look bad, but the data people at GARFO have tracked that down to: 

The issue is related to the underlying data and processing of state Warehouse records at ACCSP.  Some state partners upload state landings to the ACCSP Warehouse on an annual basis.  ACCSP performs a matching routine on those uploads that cross references them to Federal dealer landings in SAFIS.  If the match is successful, those Warehouse records are not ingested into SAFIS and therefore not ingested into CFDERS.

There is also something funky with DE: about 50% of the landings in 2022 and 2023 are not matching to permits, which is surprising because 94% of the quota is subject to a vtr requirement.

```{r CAMS_match_Fraction, fig.show = "hold", out.width = "75%", fig.cap="Fraction of Landings with Matched VTR information",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("cams_match_state.png")))
```

For the entire region, it looks like have matches for about 2/3rds of the black sea bass landings. 
```{r cams_state_veslog, fig.show = "hold", out.width = "48%", fig.cap="Fraction of Landings with Matched VTR information",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("cams_veslog_hails.png","state_cams_veslog_hails.png")))
```

I feel pretty confident about being able to model the behavior of all BSB participants in DE*, MD, NJ, and VA. This is 3 catch-share fisheries and 1 regulated limited-access fishery.  NC is a little uncertain. 

I feel pretty confident about being able to model the behavior of *federally* permitted fishing vessels.  However, in NY, RI, CT, and MA a very large fraction of the landings are not matchable to VTRs.  If we need to say something about the NY, RI, CT, and MA fishery based on the federally permitted vessels, we might be able to pull some statistics based on Coast Guard vessel data (https://www.fisheries.noaa.gov/foss/f?p=215:4:8375418615201:::::) and make some sort of claim based on length, hp, age, or tonnage.  Matching everything is hopeless. And there are still some hullid's that do not show up in this database, I think because the "hullid" is actually a state identifier that does not show up in the coast guard db. 

## Gears

The fishery is mostly Trawl and Trap, there is a little bit of Hand and gillnet. Trap seems to be growing in importance.

```{r gears_by_Category_select_years, fig.show = "hold", out.width = "48%", fig.cap="Nominal Prices by Market Category, select years",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("gears_by_year.png", "fgears_by_year.png")))
```



## Prices

Prices basically make sense and increase with size. There are definitely tendencies to have prices that in $0.05 and $0.25 increments, which causes the histograms to look really jagged.

```{r Prices_by_Category, fig.show = "hold", out.width = "80%", fig.cap="Nominal Prices by Market Category",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("price_histograms.png")))
```

The premia seem to be roughly constant over time.

```{r Prices_by_Category_select_years, fig.show = "hold", out.width = "48%", fig.cap="Nominal Prices by Market Category, select years",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("price_box1996.png", "price_box2000.png","price_box2008.png", "price_box2016.png")))
```

```{r state_prices_over_time, fig.show = "hold", out.width = "48%", fig.cap="Prices by Market Category, by state",  fig.align = "center", echo=FALSE}
states<-list.files(exploratory_images, pattern=glob2rx("price_overtime_*.png"))
knitr::include_graphics(file.path(exploratory_images,states))
```

## Sizes over time

Over time, there has been more "Large" and "Jumbo." 
```{r Sizes_over_time, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time, All States",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_over_time.png", "fmarket_cats_over_time.png")))

```
CT in 2007, although about 20% is still unclassified.

DE in 2001, although the unclassifieds come back in 2022 and 2023.

MA is always classified, although 15 to 20% are unclassified. 

MD is always classified, although there are a few years when it's picks up to 20+%
	MD might also be responsible for the extra smalls in our data in 2018

NC is always classified. And lots of Jumbo.	

NJ is always classified, with about 5-10% per year Unclassified. Jumbo and Large have been increasing there too


NY has quite alot of unclassified Typically 30%

RI starts classifying in 1997, typically less than 5% unclassified.

VA is all classified, except for 2021 to 2023.

One trip pulled in substantially all the Extra small in MD ever in 2019. This feels a little sketch
browse if market_code=="ES" & state=="MD"

```{r Sizes_VA, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_VA.png", "fmarket_cats_VA.png")))
```

```{r Sizes_MD, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_MD.png", "fmarket_cats_MD.png")))
```


```{r Sizes_DE, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_DE.png", "fmarket_cats_DE.png")))
```


```{r Sizes_NJ, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_NJ.png", "fmarket_cats_NJ.png")))
```

```{r Sizes_NY, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_NY.png", "fmarket_cats_NY.png")))
```


```{r Sizes_CT, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_CT.png", "fmarket_cats_CT.png")))
```

```{r Sizes_RI, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_RI.png", "fmarket_cats_RI.png")))
```
```{r Sizes_MA, fig.show = "hold", out.width = "48%", fig.cap="Market Category over time",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("market_cats_MA.png", "fmarket_cats_MA.png")))
```



# Vessels over time
How many vessels do I have over time, in each state?  Stacked bar charts of landings in each state. I've dropped out the "unknown" permits and hullids. I ranked each vessel in each state by landings over the 1996-2024 time period. There's no tracking of ownership.  I think the colors within each panel are good (I don't think there is recycling). Colors don't carry over across panels.  Not all states have 25 permits/vessels (DE, MD) 


```{r Permits_VA, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit in VA",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_VA.png", "hullid_VA.png")))
```

```{r Permits_MD, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) MD",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_MD.png", "hullid_MD.png")))
```


```{r Permits_DE, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) DE",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_DE.png", "hullid_DE.png")))
```


```{r Permits_NJ, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) NJ",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_NJ.png", "hullid_NJ.png")))
```

```{r Permits_NY, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) NY",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_NY.png", "hullid_NY.png")))
```


```{r Permits_CT, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) CT",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_CT.png", "hullid_CT.png")))
```

```{r Permits_RI, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) RI",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_RI.png", "hullid_RI.png")))
```
```{r Permits_MA, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) MA",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_MA.png", "hullid_MA.png")))
```

```{r Permits_overall, fig.show = "hold", out.width = "48%", fig.cap="Landings by Permit (L) and Hullid (R) MA",  fig.align = "center", echo=FALSE}
knitr::include_graphics(file.path(exploratory_images,c("permit_coastwide.png", "hullid_coastwide.png")))
```

# Trips






# Things to Figure out

1. Has commercial quota ever been transferred?
2. How do the states and ASMFC monitor the quota usage? Is has to be based on landed state, right?
3. Data issues with DE. And With VA.

<!---
\newpage
--->
# References
<div id="refs"></div>




